<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SecureVote â€“ Registered Voters</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
body {
  background: linear-gradient(to right, #1c3c72, #2a5298);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  min-height: 100vh;
  color: #333;
}

/* Dashboard Cards */
.dashboard-card {
  background: #fff;
  border-radius: 15px;
  padding: 20px;
  margin-bottom: 25px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  text-align: center;
  transition: transform 0.3s, box-shadow 0.3s;
}
.dashboard-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}
.dashboard-card h4 { font-weight: bold; margin: 0; }
.dashboard-card i { font-size: 2rem; margin-bottom: 5px; }

/* Table Card */
.table-card {
  background: #fff;
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  margin-bottom: 30px;
}
.table-card h3 { margin-bottom: 20px; }
.table-card .badge { font-size: 0.9rem; }

/* Action Buttons */
.action-btns i { cursor: pointer; transition: color 0.3s; }
.action-btns i:hover { color: #0d6efd; }

/* Search input */
#searchInput { margin-bottom: 15px; }

/* Responsive Adjustments */
@media(max-width: 768px) {
  .dashboard-card i { font-size: 1.5rem; }
}
</style>
</head>
<body>
<div class="container py-4">

  <!-- Dashboard Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-3 col-sm-6">
      <div class="dashboard-card">
        <i class="fas fa-users text-primary"></i>
        <h4 id="totalVoters">0</h4>
        <small>Total Registered</small>
      </div>
    </div>
    <div class="col-md-3 col-sm-6">
      <div class="dashboard-card">
        <i class="fas fa-user-plus text-success"></i>
        <h4 id="todayRegistered">0</h4>
        <small>Registered Today</small>
      </div>
    </div>
  </div>

  <!-- Voters Table -->
  <div class="table-card">
    <h3><i class="fas fa-users me-2"></i> Registered Voters <span class="badge bg-dark" id="voterCount">0</span></h3>

    <input type="text" id="searchInput" class="form-control" placeholder="Search by index number, name, or role...">

    <div class="table-responsive mt-3">
      <table class="table table-striped table-bordered align-middle">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Index Number</th>
            <th>Name</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="votersTableBody"></tbody>
      </table>
    </div>

    <div class="mt-3 d-flex flex-wrap gap-2">
      <button id="exportCsvBtn" class="btn btn-outline-dark"><i class="fas fa-file-csv"></i> Export CSV</button>
      <button id="printBtn" class="btn btn-primary"><i class="fas fa-print"></i> Print</button>
    </div>
  </div>
</div>

<!-- Edit Voter Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel"><i class="fas fa-edit"></i> Edit Voter</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editVoterForm">
          <div class="mb-3">
            <label for="editIndex" class="form-label">Index Number</label>
            <input type="text" id="editIndex" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="editName" class="form-label">Name</label>
            <input type="text" id="editName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="editRole" class="form-label">Role</label>
            <select id="editRole" class="form-select" required>
              <option value="User">User</option>
              <option value="Admin">Admin</option>
            </select>
          </div>
          <input type="hidden" id="editIndexHidden">
          <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save"></i> Save Changes</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// JS logic (same as your original code, fully compatible)
document.addEventListener("DOMContentLoaded", () => {
  const tableBody = document.getElementById("votersTableBody");
  const searchInput = document.getElementById("searchInput");
  const totalVotersEl = document.getElementById("totalVoters");
  const todayRegisteredEl = document.getElementById("todayRegistered");
  const voterCountEl = document.getElementById("voterCount");

  let registeredVoters = JSON.parse(localStorage.getItem("registeredVoters")) || [];
  if (!registeredVoters.length) {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    registeredVoters = users.map(u => ({
      index: u.index || u,
      name: u.name || "N/A",
      role: u.role || "User",
      registeredDate: new Date().toISOString()
    }));
    localStorage.setItem("registeredVoters", JSON.stringify(registeredVoters));
  }

  function updateDashboard() {
    const today = new Date().toISOString().slice(0, 10);
    totalVotersEl.textContent = registeredVoters.length;
    todayRegisteredEl.textContent = registeredVoters.filter(v => v.registeredDate.slice(0,10) === today).length;
    voterCountEl.textContent = registeredVoters.length;
  }

  function renderTable(data) {
    tableBody.innerHTML = "";
    data.forEach((voter, i) => {
      const roleClass = voter.role === "Admin" ? "text-primary fw-bold" : "text-success";
      tableBody.innerHTML += `
        <tr>
          <td>${i+1}</td>
          <td>${voter.index}</td>
          <td>${voter.name}</td>
          <td class="${roleClass}">${voter.role}</td>
          <td class="action-btns">
            <i class="fas fa-edit text-primary me-2" onclick="openEditModal(${i})" title="Edit"></i>
            <i class="fas fa-trash text-danger" onclick="deleteVoter(${i})" title="Delete"></i>
          </td>
        </tr>
      `;
    });
  }

  // Functions for edit, delete, search, CSV, print (same as your original code)
  window.deleteVoter = function(index) {
    if(confirm("Are you sure you want to delete this voter?")) {
      registeredVoters.splice(index, 1);
      localStorage.setItem("registeredVoters", JSON.stringify(registeredVoters));
      renderTable(registeredVoters);
      updateDashboard();
    }
  }

  window.openEditModal = function(index) {
    const voter = registeredVoters[index];
    document.getElementById("editIndex").value = voter.index;
    document.getElementById("editName").value = voter.name;
    document.getElementById("editRole").value = voter.role;
    document.getElementById("editIndexHidden").value = index;
    const modal = new bootstrap.Modal(document.getElementById("editModal"));
    modal.show();
  }

  document.getElementById("editVoterForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const index = parseInt(document.getElementById("editIndexHidden").value);
    const newIndex = document.getElementById("editIndex").value.trim();
    const newName = document.getElementById("editName").value.trim();
    const newRole = document.getElementById("editRole").value;

    if (registeredVoters.some((v, i) => v.index === newIndex && i !== index)) {
      alert("This index number already exists!");
      return;
    }

    registeredVoters[index].index = newIndex;
    registeredVoters[index].name = newName;
    registeredVoters[index].role = newRole;
    localStorage.setItem("registeredVoters", JSON.stringify(registeredVoters));
    renderTable(registeredVoters);
    updateDashboard();
    bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();
  });

  searchInput.addEventListener("input", () => {
    const term = searchInput.value.toLowerCase();
    const filtered = registeredVoters.filter(v =>
      (v.index || "").toLowerCase().includes(term) ||
      (v.name || "").toLowerCase().includes(term) ||
      (v.role || "").toLowerCase().includes(term)
    );
    renderTable(filtered);
  });

  document.getElementById("exportCsvBtn").addEventListener("click", () => {
    let csv = "Index Number,Name,Role\n";
    registeredVoters.forEach(v => {
      csv += `${v.index},${v.name},${v.role}\n`;
    });
    let blob = new Blob([csv], { type: "text/csv" });
    let url = window.URL.createObjectURL(blob);
    let a = document.createElement("a");
    a.href = url;
    a.download = "registered_voters.csv";
    a.click();
  });

  document.getElementById("printBtn").addEventListener("click", () => window.print());

  renderTable(registeredVoters);
  updateDashboard();
});
</script>
</body>
</html>
